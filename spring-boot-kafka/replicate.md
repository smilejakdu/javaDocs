# replicate

## Why replicate?&#x20;



<figure><img src="../.gitbook/assets/스크린샷 2024-03-19 오후 7.50.19.png" alt=""><figcaption></figcaption></figure>

Kafka에서 'replication'(복제)은 데이터의 내구성과 가용성을 높이기 위해 사용되는 중요한 기능입니다. 복제는 Kafka 클러스터 내의 여러 서버(브로커)에 걸쳐 토픽의 파티션을 복사하는 과정을 의미합니다.

#### 복제의 작동 방식:

1. **리더와 팔로워**: 각 파티션에는 '리더'(Leader)와 하나 이상의 '팔로워'(Follower)가 있습니다. 리더는 모든 읽기 및 쓰기 작업(메시지의 생산과 소비)에 대한 주요 책임자입니다. 팔로워는 리더의 데이터를 복제하고, 리더에게 장애가 발생할 경우 리더의 역할을 대신할 준비를 합니다.
2. **데이터 복제**: 생산자(Producer)가 메시지를 파티션에 발행하면, 해당 메시지는 먼저 파티션의 리더에 의해 처리됩니다. 이후, 메시지는 모든 팔로워에게 복제됩니다. 팔로워는 리더로부터 받은 메시지를 자신의 로그에 순차적으로 기록함으로써 리더를 따라갑니다.
3. **장애 복구**: 리더에게 장애가 발생하면, 클러스터의 컨트롤러(Controller)는 살아있는 팔로워 중 하나를 새로운 리더로 선출합니다. 이로 인해 시스템의 가용성이 유지됩니다.
4. **복제 요소 설정**: Kafka의 복제는 `replication.factor` 설정을 통해 관리됩니다. 이 값은 특정 토픽에 대해 생성되어야 하는 복제본의 수를 정의합니다. 예를 들어, `replication.factor`가 3이면, 각 파티션에 대해 리더 한 개와 두 개의 팔로워가 생성됩니다.

#### 복제의 목적:

* **데이터 내구성**: 서버 하나에 장애가 발생해도, 다른 서버에 복제된 데이터가 있기 때문에 정보의 손실을 방지할 수 있습니다.
* **시스템 가용성**: 리더가 실패할 경우 팔로워 중 하나가 새로운 리더로 승격되어 서비스를 계속 제공할 수 있습니다.
* **부하 분산**: 팔로워는 데이터 읽기 요청(소비자로부터의 요청)을 처리할 수 있어, 리더에게 가는 읽기 부하를 줄일 수 있습니다(이 기능은 Kafka 설정에 따라 다릅니다).

Kafka의 복제 기능은 데이터를 안전하게 보관하고, Kafka 시스템 전체의 가용성을 높이는 데 핵심적인 역할을 합니다.



원본 파티션을 Leader Partition 이라고 합니다.&#x20;

그리고 두번째 부터의 Partition 을 Follow Partition 이라고 합니다.



<figure><img src="../.gitbook/assets/스크린샷 2024-03-19 오후 7.54.28.png" alt=""><figcaption></figcaption></figure>

{% embed url="https://damdam-kim.tistory.com/17" %}

##

## ack



