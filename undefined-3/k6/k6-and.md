# K6 이란 ? & 환경 셋팅



## K6 이란 ??

k6는 고성능 로드테스트 툴이며, 자바스크립트 스크립팅 할 수 있다.

이러한 이점을 가져오기 위해서 트레이드 오프한 내용이 있다.

브라우저에서 네이티브하게 수행할 수 없다.

* 기본적으로 k6는 웹 페이지를 브라우저와 같은 방법으로 렌더링 할 수 없다.
* 브라우저들은 시스템 리소르를 많이 사용한다.
* 브라우저가 빠지면 단일 기기에서 더 많은 로드를 실행할 수 있다.
* 그러나 k6-browser를 사용하면 실제 브라우저와 상호작용하고 k6 테스트 일부로 프런트엔드 메트릭을 수집할 수 있다. Node JS 에서 수행되지 않는다.





## 환경 셋팅

brew install k6

설치하고 나서&#x20;



Java Spring Boot 프로젝트에 k6를 적용하기 위해 여러 단계를 따라야 합니다. 이 과정은 기본적으로 모든 웹 애플리케이션에 k6를 적용하는 방법과 유사하지만, Spring Boot 특성에 맞게 조정할 수 있습니다.

1. **환경 설정**: 우선, Spring Boot 애플리케이션이 로컬 환경에서 정상적으로 실행되고 있는지 확인합니다. 애플리케이션이 실행 중이어야 k6로 테스트할 수 있습니다.
2. **k6 설치**: k6는 로컬 컴퓨터에 설치되어야 합니다. 이는 위에서 언급한 대로 운영 체제에 맞는 방법으로 설치할 수 있습니다.
3.  **테스트 스크립트 작성**: Spring Boot 애플리케이션의 특정 엔드포인트에 대한 테스트 스크립트를 JavaScript로 작성합니다. 예를 들어, 사용자 등록, 로그인, 데이터 조회 등의 기능을 테스트할 수 있습니다. 이 스크립트는 앞서 제공된 예제와 유사하게 작성할 수 있지만, 실제 요청 URL은 Spring Boot 애플리케이션의 엔드포인트로 변경해야 합니다.

    ```javascript
    import http from 'k6/http';
    import { check, sleep } from 'k6';

    export let options = {
      stages: [
        { duration: '2m', target: 100 }, // 아래로 2분 동안 사용자 수를 100까지 늘림
        { duration: '4m', target: 100 }, // 위로 4분 동안 고정
        { duration: '2m', target: 0 },   // 아래로 2분 동안 사용자 수를 0으로 줄임
      ],
    };

    export default function () {
      let res = http.get('http://localhost:8080/api/your-endpoint');
      check(res, { 'status was 200': (r) => r.status == 200 });
      sleep(1);
    }
    ```

    이 스크립트는 애플리케이션의 `/api/your-endpoint`에 대한 부하 테스트를 수행합니다. `options` 객체를 사용하여 테스트의 단계를 설정할 수 있습니다.
4.  **테스트 실행**: 스크립트 파일을 준비한 후, 터미널에서 k6를 사용하여 테스트를 실행합니다. 예를 들어, 스크립트 파일이 `load-test.js`라면 다음 명령어를 사용합니다:

    ```bash
    k6 run load-test.js
    ```
5. **결과 분석**: 테스트 실행 후, k6는 테스트 결과를 출력합니다. 이 데이터를 분석하여 응답 시간, 에러 비율, 처리량 등 Spring Boot 애플리케이션의 성능을 평가합니다.
6. **성능 최적화**: 테스트 결과를 바탕으로, 애플리케이션의 성능을 개선할 수 있는 영역을 식별하고 수정합니다. 이는 코드 최적화, 인프라 조정, 캐싱 전략 개선 등을 포함할 수 있습니다.

k6와 Spring Boot 애플리케이션을 함께 사용하여 부하 테스트를 수행하는 것은 애플리케이션의 성능을 이해하고 개선하는 데 매우 유용합니다.



## Spring Boot 에 적용해보기



Java Spring Boot 프로젝트에 대한 성능 테스트, 특히 위의 코드 예시와 같은 API 엔드포인트에 대해 k6를 사용하여 테스트하는 과정은 다음과 같습니다:

1. **API 엔드포인트 확인**: 먼저, 테스트할 Spring Boot 애플리케이션의 API 엔드포인트를 확인합니다. 예를 들어, `FindTeacherApplication` 클래스는 `findAllTeacher`와 `findOneTeacherById` 두 가지 주요 기능을 제공하는 것으로 보입니다. 각 기능에 대응하는 HTTP 요청의 URL, 메소드(GET, POST 등), 필요한 경우 요청 본문(body)을 정리합니다.
2.  **k6 테스트 스크립트 작성**: 이 정보를 바탕으로 k6 스크립트를 작성합니다. 예를 들어, `findAllTeacher` 엔드포인트에 대한 테스트 스크립트는 다음과 같을 수 있습니다:

    ```javascript
    import http from 'k6/http';
    import { sleep, check } from 'k6';

    export default function () {
      let response = http.get('http://localhost:8080/api/teachers?page=0&size=10'); // 여기서 URL은 실제 서버의 것으로 바꿔야 함
      check(response, {
        'is status 200': (r) => r.status === 200,
      });
      sleep(1);
    }
    ```

    `findOneTeacherById` 엔드포인트에 대해서도 비슷한 스크립트를 작성할 수 있습니다.
3. **로컬에서 Spring Boot 애플리케이션 실행**: 테스트를 수행하기 전에, 로컬에서 Spring Boot 애플리케이션을 실행해야 합니다. 이렇게 하면 k6가 로컬 서버에 요청을 보낼 수 있습니다.
4.  **k6 테스트 실행**: 테스트 스크립트를 작성한 후, 터미널에서 k6를 실행하여 성능 테스트를 수행합니다. 예를 들어:

    ```bash
    k6 run script.js
    ```

    여기서 `script.js`는 당신이 작성한 스크립트의 파일 이름입니다.
5. **결과 분석**: 테스트가 완료되면, k6는 요청 성공률, 응답 시간, 통과한 검사의 비율 등을 포함한 다양한 메트릭을 제공합니다. 이 정보를 사용하여 애플리케이션의 성능을 분석하고, 필요한 경우 최적화를 수행할 수 있습니다.
6. **부하 조건 조정**: 필요에 따라 k6 스크립트에서 가상 사용자(VUs)의 수, 테스트 지속 시간 등 부하 조건을 조정하여 다양한 부하 시나리오에서의 애플리케이션 성능을 테스트할 수 있습니다.

이 절차를 따라서 Java Spring Boot 애플리케이션에 대한 성능 테스트를 구성하고 실행할 수 있습니다. 필요에 따라 테스트를 여러 번 반복하여 애플리케이션의 성능을 철저히 이해하고 개선할 수 있습니다.

